<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>SPXVisuals</title>

<style>
/* ---------------- Base Styles ---------------- */
body {
font-family: system-ui, sans-serif;
background: #0f172a;
color: #e5e7eb;
margin: 0;
padding: 24px;
}

a { text-decoration: none; color: inherit; }

/* ---------------- Header ---------------- */
header {
position: sticky;
top: 0;
z-index: 100;
padding: 16px 24px;
display: flex;
flex-direction: column;
align-items: center;
gap: 10px;
background: linear-gradient(90deg, #3b82f6, #06b6d4, #3b82f6);
background-size: 200% 200%;
animation: gradientShift 6s ease infinite;
color: #ffffff;
}

h1 { margin: 0; font-size: 2rem; display: flex; align-items: center; gap: 12px; }

.title-link, .x-link { color: #ffffff; }

.controls { display: flex; flex-direction: column; gap: 10px; width: 100%; max-width: 420px; align-items: center; }

input[type="text"] {
padding: 6px 12px;
border-radius: 6px;
border: 1px solid #475569;
background: #020617;
color: #e5e7eb;
width: 100%;
max-width: 360px;
text-align: center;
}

.filter-buttons { display: flex; gap: 8px; flex-wrap: wrap; justify-content: center; }

button {
background: var(--bg-color, #020617);
color: #e5e7eb;
border: none;
border-radius: 6px;
padding: 6px 12px;
cursor: pointer;
transition: background 0.3s, color 0.3s;
}

button:hover { background: #1e293b; }

button.active {
background: #ffffff;
color: var(--bg-color, #020617);
}

#clearSearch { display:none; background:#111827; }

main { display: grid; grid-template-columns: repeat(2, 1fr); gap: 32px; }

.post { margin-bottom: 40px; }

.post img {
width:100%;
border-radius:10px;
margin:16px 0;
cursor:zoom-in;
}

.hashtags { display:flex; gap:6px; flex-wrap:wrap; }

.hashtags a { color:#22d3ee; font-size:.85rem; }

.post-date { font-size:.8rem; color:#94a3b8; margin-bottom:6px; }

.image-modal {
position:fixed;
inset:0;
background:rgba(0,0,0,.85);
display:flex;
align-items:center;
justify-content:center;
z-index:9999;
}

.image-modal img { max-width:95%; max-height:95%; border-radius:12px; }

@media (max-width:768px){ main{column-count:1;} }
</style>
</head>

<body>
<header>
<h1>üìä <a href="https://spxvisuals.github.io/" class="title-link">SPXVisuals</a> üìà</h1>
<a href="https://x.com/SPXVisuals" target="_blank" class="x-link">ùïè</a>

<div class="controls">
<input type="text" id="search" placeholder="Search by hashtag or MM/DD/YYYY" />
<div class="filter-buttons">
<button id="todayFilter">Today's Charts</button>
<button id="weekFilter">This Week</button>
<button id="monthFilter">This Month</button>
<button id="clearSearch">Clear</button>
</div>
</div>
</header>

<main id="posts"></main>

<footer>¬© 2026 SPXVisuals</footer>

<script>
async function loadPosts() {
  const indexRes = await fetch('output/metadata/index.json');
  const files = await indexRes.json();
  const all = [];

  for (const file of files) {
    const res = await fetch(`output/metadata/${file}`);
    const daily = await res.json();

    const dateMatch = file.match(/\d{4}-\d{2}-\d{2}/);
    const date = dateMatch ? dateMatch[0] : '';

    daily.forEach(p => {
      all.push({
        date,
        text: p.tweet_text,
        images: p.images || [],
        url: p.tweet_url,
        hashtags: extractHashtags(p.tweet_text || '')
      });
    });
  }

  return all.sort((a,b)=> new Date(b.date) - new Date(a.date));
}

function extractHashtags(text){
  return [...text.matchAll(/#[A-Za-z0-9_]+/g)].map(m=>m[0]);
}

function todayLocalISO(){
  const d=new Date(); d.setHours(0,0,0,0);
  return d.toISOString().slice(0,10);
}

function normalizeDateInput(input){
  const m=input.match(/^(\d{2})\/(\d{2})\/(\d{4})$/);
  if(!m) return input;
  return `${m[3]}-${m[1]}-${m[2]}`;
}

function renderPosts(posts){
  const c=document.getElementById('posts');
  c.innerHTML='';
  if(!posts.length){ c.innerHTML='<div>No charts match üìâ</div>'; return; }

  posts.forEach(p=>{
    const d=document.createElement('div');
    d.className='post';
    d.innerHTML=`
      ${p.url?`<a href="${p.url}" target="_blank">See Post On ùïè</a>`:''}
      <div class="post-date">${p.date}</div>
      <div class="hashtags">${p.hashtags.map(h=>`<a href="#">${h}</a>`).join('')}</div>
      <div>${p.text}</div>
      ${p.images.map(i=>`<img src="${i}" loading="lazy">`).join('')}
    `;
    d.querySelectorAll('.hashtags a').forEach(a=>{
      a.onclick=e=>{
        e.preventDefault();
        search.value=a.textContent;
        applyFilters();
      }
    });
    c.appendChild(d);
  });
}

let allPosts=[];
const filters={today:false,week:false,month:false};

function updateButtons(){
  todayFilter.classList.toggle('active',filters.today);
  weekFilter.classList.toggle('active',filters.week);
  monthFilter.classList.toggle('active',filters.month);
  clearSearch.style.display=(filters.today||filters.week||filters.month||search.value)?'inline-block':'none';
}

function applyFilters(){
  let input=normalizeDateInput(search.value.toLowerCase());

  let filtered=allPosts.filter(p=>
    p.hashtags.some(h=>h.toLowerCase().includes(input)) ||
    p.date.includes(input)
  );

  const now=new Date(todayLocalISO());

  if(filters.today) filtered=filtered.filter(p=>p.date===todayLocalISO());
  if(filters.week){
    const d=new Date(now); d.setDate(now.getDate()-7);
    filtered=filtered.filter(p=>new Date(p.date)>=d);
  }
  if(filters.month){
    const d=new Date(now); d.setMonth(now.getMonth()-1);
    filtered=filtered.filter(p=>new Date(p.date)>=d);
  }

  renderPosts(filtered);
  updateButtons();
}

search.oninput=applyFilters;

todayFilter.onclick=()=>{filters.today=!filters.today;filters.week=filters.month=false;applyFilters();};
weekFilter.onclick=()=>{filters.week=!filters.week;filters.today=filters.month=false;applyFilters();};
monthFilter.onclick=()=>{filters.month=!filters.month;filters.today=filters.week=false;applyFilters();};

clearSearch.onclick=()=>{
  search.value='';
  filters.today=filters.week=filters.month=false;
  renderPosts(allPosts);
  updateButtons();
};

loadPosts().then(p=>{allPosts=p;renderPosts(allPosts);updateButtons();});
</script>

<script>
document.addEventListener('click',e=>{
 if(e.target.tagName==='IMG'){
   const m=document.createElement('div');
   m.className='image-modal';
   m.innerHTML=`<img src="${e.target.src}">`;
   m.onclick=()=>m.remove();
   document.body.appendChild(m);
 }
});
</script>

</body>
</html>
