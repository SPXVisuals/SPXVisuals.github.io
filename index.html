<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SPXVisuals</title>
  <style>
    /* General Styles */
    body {
      font-family: system-ui, sans-serif;
      background: #0f172a;
      color: #e5e7eb;
      margin: 0;
      padding: 0;
    }

    a {
      color: #3b82f6;
      text-decoration: none;
      cursor: pointer;
    }

    h1 {
      margin: 0;
      padding: 16px 24px;
      font-size: 2rem;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      background: #3b82f6; /* sticky blue header */
      position: sticky;
      top: 0;
      z-index: 999;
    }

    header .icon {
      font-size: 1.5rem;
    }

    /* Search bar */
    .search-bar {
      display: flex;
      justify-content: center;
      margin: 16px;
      gap: 8px;
    }

    .search-bar input {
      padding: 8px;
      border-radius: 4px;
      border: none;
      width: 200px;
    }

    .toggle-buttons {
      display: flex;
      justify-content: center;
      gap: 12px;
      margin-bottom: 16px;
    }

    .toggle-buttons button {
      background: #1e293b;
      color: #e5e7eb;
      border: none;
      padding: 6px 12px;
      border-radius: 4px;
      cursor: pointer;
    }

    .toggle-buttons button.active {
      background: #3b82f6;
    }

    /* Grid layout */
    .posts-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 16px;
      padding: 16px 24px;
    }

    .post {
      background: #111827;
      border-radius: 8px;
      padding: 12px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .post img {
      width: 100%;
      border-radius: 8px;
      background: #111827;
    }

    .hashtags {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .hashtags a {
      font-size: 0.85rem;
      background: #1e293b;
      padding: 2px 6px;
      border-radius: 4px;
    }

    .post-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.85rem;
    }

    /* Light/Dark mode */
    body.light {
      background: #f9fafb;
      color: #1f2937;
    }

    body.light .post {
      background: #ffffff;
    }

    body.light .search-bar input {
      background: #f3f4f6;
      color: #1f2937;
    }

    body.light a {
      color: #2563eb;
    }

    footer {
      text-align: center;
      padding: 16px;
      font-size: 0.85rem;
      color: #9ca3af;
    }
  </style>
</head>
<body>
  <h1>
    <span class="icon">ðŸ“Š</span>
    SPXVisuals
    <span class="icon">ðŸ“ˆ</span>
  </h1>

  <div class="search-bar">
    <input type="text" id="searchInput" placeholder="Search hashtags or date MM/DD/YYYY">
    <button onclick="clearSearch()">Clear</button>
  </div>

  <div class="toggle-buttons">
    <button id="weeklyBtn" class="active" onclick="toggleWeekMonth('week')">This Week</button>
    <button id="monthlyBtn" onclick="toggleWeekMonth('month')">This Month</button>
  </div>

  <section>
    <h2>Today's Charts</h2>
    <div id="todaysCharts" class="posts-grid"></div>
  </section>

  <section>
    <h2>All Charts</h2>
    <div id="allCharts" class="posts-grid"></div>
  </section>

  <footer>Â© 2026 SPXVisuals</footer>

  <script>
    let postsData = [];
    let filteredData = [];
    let currentToggle = 'week';

    // Load JSON posts dynamically
    async function loadPosts() {
      try {
        const response = await fetch('output/metadata/posts.json');
        const data = await response.json();
        postsData = data.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
        filteredData = [...postsData];
        renderPosts();
        renderTodaysCharts();
      } catch (err) {
        console.error("Error loading posts JSON:", err);
      }
    }

    function renderPosts() {
      const container = document.getElementById('allCharts');
      container.innerHTML = '';

      filteredData.forEach(post => {
        const postDiv = document.createElement('div');
        postDiv.className = 'post';
        postDiv.dataset.hashtags = post.hashtags?.join(' ') || '';
        postDiv.dataset.date = new Date(post.created_at).toLocaleDateString();

        const imgEl = document.createElement('img');
        imgEl.src = post.images[0];
        imgEl.loading = 'lazy';
        imgEl.alt = post.tweet_text || 'Chart image';
        imgEl.onclick = () => {
          trackClick(post);
          window.open(post.url, '_blank');
        };

        const textDiv = document.createElement('div');
        textDiv.textContent = post.tweet_text || '';

        const hashtagsDiv = document.createElement('div');
        hashtagsDiv.className = 'hashtags';
        (post.hashtags || []).forEach(tag => {
          const tagLink = document.createElement('a');
          tagLink.textContent = tag;
          tagLink.onclick = () => filterByHashtag(tag);
          hashtagsDiv.appendChild(tagLink);
        });

        const footerDiv = document.createElement('div');
        footerDiv.className = 'post-footer';
        const xLink = document.createElement('a');
        xLink.href = post.url;
        xLink.target = "_blank";
        xLink.textContent = "X";
        footerDiv.appendChild(xLink);
        footerDiv.appendChild(document.createTextNode(postDiv.dataset.date));

        postDiv.appendChild(imgEl);
        postDiv.appendChild(textDiv);
        postDiv.appendChild(hashtagsDiv);
        postDiv.appendChild(footerDiv);

        container.appendChild(postDiv);
      });
    }

    function renderTodaysCharts() {
      const container = document.getElementById('todaysCharts');
      container.innerHTML = '';

      const today = new Date().toLocaleDateString();
      const todaysPosts = postsData.filter(p => new Date(p.created_at).toLocaleDateString() === today);

      todaysPosts.forEach(post => {
        const postDiv = document.createElement('div');
        postDiv.className = 'post';
        const imgEl = document.createElement('img');
        imgEl.src = post.images[0];
        imgEl.loading = 'lazy';
        imgEl.alt = post.tweet_text || 'Chart image';
        imgEl.onclick = () => {
          trackClick(post);
          window.open(post.url, '_blank');
        };
        postDiv.appendChild(imgEl);
        container.appendChild(postDiv);
      });
    }

    function filterByHashtag(tag) {
      filteredData = postsData.filter(p => p.hashtags?.includes(tag));
      renderPosts();
    }

    function searchPosts() {
      const query = document.getElementById('searchInput').value.toLowerCase();
      filteredData = postsData.filter(p => {
        const hashtags = (p.hashtags || []).join(' ').toLowerCase();
        const date = new Date(p.created_at).toLocaleDateString();
        return hashtags.includes(query) || date.includes(query);
      });
      renderPosts();
    }

    function clearSearch() {
      document.getElementById('searchInput').value = '';
      filteredData = [...postsData];
      renderPosts();
    }

    function toggleWeekMonth(type) {
      currentToggle = type;
      const weeklyBtn = document.getElementById('weeklyBtn');
      const monthlyBtn = document.getElementById('monthlyBtn');

      if (type === 'week') {
        weeklyBtn.classList.add('active');
        monthlyBtn.classList.remove('active');
        weeklyBtn.textContent = weeklyBtn.textContent === 'This Week' ? 'All Weeks' : 'This Week';
      } else {
        monthlyBtn.classList.add('active');
        weeklyBtn.classList.remove('active');
        monthlyBtn.textContent = monthlyBtn.textContent === 'This Month' ? 'All Months' : 'This Month';
      }

      // filter posts by week/month if needed
      // (optional: implement real filtering by week/month)
    }

    function trackClick(post) {
      console.log("Chart clicked:", post.url);
      // Placeholder for analytics tracking (Plausible / GA)
    }

    // Light/Dark mode toggle (example)
    document.addEventListener('keydown', e => {
      if (e.key === 'd') document.body.classList.toggle('light');
    });

    document.getElementById('searchInput').addEventListener('input', searchPosts);

    // Load posts automatically
    loadPosts();
  </script>
</body>
</html>
